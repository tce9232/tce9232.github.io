<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Web Scraping on Ted Carlson&#39;s Data Blog</title>
    <link>/tags/web-scraping/</link>
    <description>Recent content in Web Scraping on Ted Carlson&#39;s Data Blog</description>
    <generator>Source Themes academia (https://sourcethemes.com/academic/)</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 15 Nov 2020 13:41:02 -0600</lastBuildDate>
    
	    <atom:link href="/tags/web-scraping/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Madison Landlord Lookup Tool</title>
      <link>/project/madison-landlords/</link>
      <pubDate>Sun, 15 Nov 2020 13:41:02 -0600</pubDate>
      
      <guid>/project/madison-landlords/</guid>
      <description>&lt;p&gt;Everyone who has changed leases in Madison Wisconsin, or even just been in town during the nights of July 31st or August 14th knows the horrors of Madison moving day. For those that haven&amp;rsquo;t experienced this ritual, it forces thousands of predominantly students and younger tenents to move out a full day, or even up to a couple weeks before their new lease kicks in. Almost all Madison leases either start on August 1st or August 15th, but you&amp;rsquo;re typically required to move out the previous day. This causes a huge battle for U-Hauls and parking spaces so residents can pack up all of their belongings and move to the place they&amp;rsquo;re going to stay the night before their new lease begins. Some especially unlucky tenents will have to pay double rent for the first half of August, as their leases overlap, or even worse, not have any lease for that time period. For people that have lived in Madison as long as I have, this ritual might seem almost normal. But for those that are new students or new to the Madison renting schedule, this phenomenon makes no sense at all.&lt;/p&gt;
&lt;p&gt;However, from a property management perspective, this ritual makes perfect sense. It balances out your leases so you only have to pay for maintenance and cleaning during one day, and since month-to-month leases aren&amp;rsquo;t common, you don&amp;rsquo;t have to worry about constantly finding new tenents. There&amp;rsquo;s a very predictable yearly leasing pattern that allows you to properly market and sell your properties at the highest price possible.&lt;/p&gt;
&lt;p&gt;So what gives? Why are landlords allowed to force tenants to accommodate to their schedule, and why doesn&amp;rsquo;t our state and local government push back? &lt;a href=&#34;https://www.evictedbook.com/&#34;&gt;Entire books&lt;/a&gt; can be written about how unfair the Wisconsin housing protections are. And Madison is still primarily a college town, which can lead to more predatory leases. But I wanted to take a closer look at the networks of Madison properties and their owners to see if I could visualize the extent to which the properties downtown and near campus are monopolized by just a handful of property management companies. Creating this visualization/tool could also lead to better tenant organization, as tenants would easily be able to see which addresses were owned by the same landlord.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/hippiechristmas.jpg&#34; alt=&#34;pic_name&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;data-scraping&#34;&gt;Data Scraping&lt;/h3&gt;
&lt;p&gt;The City of Madison Assessor&amp;rsquo;s Office website allows you to search and obtain data for any commercial or residential property in Madison. By doing a bit of manual work and a bit of web scraping, I was able to obtain a link to every property in Madison that was owned by an entity that starts with a standard English alpha-numeric character. Another python script visited each page and scraped information like the address, owner name, property value, property type (Apartment, Condo, etc..) and property class (commercial, residential, etc..). Here&amp;rsquo;s an example of the text parsing require to get a property&amp;rsquo;s address:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; soup&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;find(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;span&amp;#39;&lt;/span&gt;, class_&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;nav-heading&amp;#39;&lt;/span&gt;)
    p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; re&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;compile(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Address[\s]+([\w ,&amp;amp;-+%#]+)&amp;#39;&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;data-cleaning&#34;&gt;Data Cleaning&lt;/h3&gt;
&lt;p&gt;In order to properly clean the data, I needed to fill missing values with zeros and removing the dollar sign from the property values. For the purposes of this project, I combined both Condos and Apartments as &amp;ldquo;Apartments&amp;rdquo;. This is because the owners of these condos according to the Assessor&amp;rsquo;s website are often the owners of the building.&lt;/p&gt;
&lt;p&gt;The most important aspect of the cleaning was finding a proper mapping for owner names. This is challenging because you&amp;rsquo;ll often have the same owner with different names depending on the building. Some of these are typos, but most of them are a result of displaying additional information in the owner name, like the address or name of the property manager (who usually works for the property management company). This was the most labor intensive aspect of the project, and I couldn&amp;rsquo;t find a better way to accomplish this except looking for key characters that would indicate something like this happening (# was often used before an address or property manager name) or searching for the biggest rental companies I knew in Madison and seeing if they had a consistent naming pattern.&lt;/p&gt;
&lt;p&gt;Once this owner name cleaning was done, I was able to calculate the number of units from each apartment by parsing the building information using the following python code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; re&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;compile(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;([\d]+) unit&amp;#39;&lt;/span&gt;)
df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Units&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;property_type&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;str&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;findall(p)
df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Units&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pd&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to_numeric(df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Units&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;apply(&lt;span style=&#34;color:#66d9ef&#34;&gt;lambda&lt;/span&gt; x: &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; x &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; x &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; isinstance(x, float) &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; x[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I was then able to sum the total number of buildings, units, and property value for each owner name, which helped create aggregated statistics for each property owner across Madison.&lt;/p&gt;
&lt;p&gt;At this point, I had to make a decision about which properties should be included in this dataset. I didn&amp;rsquo;t want to include private personal properties, but I still wanted to make sure I was including houses that got split into floors and were leased out, as they constitute a majority of the units around campus. For these reasons, I included any apartments or single family homes that were either owned by somebody with multiple properties or had a value over $1 million. This isn&amp;rsquo;t a perfect metric, as there are obviously private homes worth more than $1 million in Madison, but it was the only way I found to ensure the inclusion of large apartment complexes that were, for whatever reason, classified as single family homes.&lt;/p&gt;
&lt;p&gt;Once I finalized the properties that would be included in the visualization, I converted each of their text addresses into long-lats using GeoPy in the following code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 1 - conveneint function to delay between geocoding calls&lt;/span&gt;
geocode &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RateLimiter(locator&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;geocode, min_delay_seconds&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
landlordDF[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;exact_address&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; landlordDF[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;address&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;apply(&lt;span style=&#34;color:#66d9ef&#34;&gt;lambda&lt;/span&gt; x: str(x) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34; Madison, Wisconsin USA&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;# 2- - create location column&lt;/span&gt;
landlordDF[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;location&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; landlordDF[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;exact_address&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;apply(geocode)
&lt;span style=&#34;color:#75715e&#34;&gt;# 3 - create longitude, laatitude and altitude from location column (returns tuple)&lt;/span&gt;
landlordDF[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;point&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; landlordDF[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;location&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;apply(&lt;span style=&#34;color:#66d9ef&#34;&gt;lambda&lt;/span&gt; loc: tuple(loc&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;point) &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; loc &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; None)
&lt;span style=&#34;color:#75715e&#34;&gt;# 4 - split point column into latitude, longitude and altitude columns&lt;/span&gt;
landlordDF[[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;latitude&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;longitude&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;altitude&amp;#39;&lt;/span&gt;]] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pd&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;DataFrame(landlordDF[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;point&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;tolist(), index&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;landlordDF&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;index)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This step is tricky, as you can easily max out on calls to GeoPy if you don&amp;rsquo;t limit your call attempts. But after almost a full day of letting this code run, it allowed me to convert the data into a GeoJSON format, which is easily readable by Mapbox.&lt;/p&gt;
&lt;h3 id=&#34;data-analysis&#34;&gt;Data Analysis&lt;/h3&gt;
&lt;p&gt;After gathering and aggregating this data, my first goal was to see which landlords owned the collective highest valued properties in Madison. Looking at the top ten landlords by property value, it becomes clear that owning a large apartment complex or two will add to a higher value than a large portfolio of homes or small apartment buildings.&lt;/p&gt;
&lt;p&gt;
  
  &lt;script src=&#34;https://cdn.plot.ly/plotly-latest.min.js&#34;&gt;&lt;/script&gt;



&lt;div id=&#34;/plotly/Properties-Owner-Bar.json&#34; class=&#34;plotly&#34; style=&#34;height:600px&#34;&gt;&lt;/div&gt;
&lt;script&gt;
Plotly.d3.json(&#34;/plotly/Properties-Owner-Bar.json&#34;, function(err, fig) {
    Plotly.plot(&#39;\/plotly\/Properties-Owner-Bar.json&#39;, fig.data, fig.layout, {responsive: true});
});
&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;Every owner except Forward Management, who owns a bunch of properties on the far East and West sides, owns 11 or fewer buildings. The landlord with the highest valued portfolio is Core Campus Madison LLC, who owns The Hub and The James, two gigantic luxury apartment complexes near downtown and campus. Since we noticed this trend of landlords with fewer properties owning the most property value, I wanted to see how this relationship looked across all landlords in my database.&lt;/p&gt;


&lt;div id=&#34;/plotly/Value-Properties-Scatter.json&#34; class=&#34;plotly&#34; style=&#34;height:600px&#34;&gt;&lt;/div&gt;
&lt;script&gt;
Plotly.d3.json(&#34;/plotly/Value-Properties-Scatter.json&#34;, function(err, fig) {
    Plotly.plot(&#39;\/plotly\/Value-Properties-Scatter.json&#39;, fig.data, fig.layout, {responsive: true});
});
&lt;/script&gt;
&lt;p&gt;The plot seems to tell us that landlords with fewer properties tend to own more valuable ones, but landlords with more properties own relatively little in value. This seems to be because developers of large luxury apartments tend to just own a few properties, but manage hundreds of units. On the flip side, there are some landlords like Madtown Properties Inc and Madison Opera Inc that own large buildings of condos that are individually listed at very low prices. Madtown Properties Inc owns the condos near Hilldale Mall, which are valued at only $15,000 each, and Madison Opera Inc owns the condos on 23 N Brooms St, which are valued at $8,000 each.&lt;/p&gt;
&lt;p&gt;Perhaps a better visualization would be to look at a landlord&amp;rsquo;s total values against their total number of rental units. I measured these by scraping any number that came after the word &amp;ldquo;Unit&amp;rdquo; in the building description, and if there was none, then just defaulting to 1.&lt;/p&gt;


&lt;div id=&#34;/plotly/Value-Units-Scatter.json&#34; class=&#34;plotly&#34; style=&#34;height:600px&#34;&gt;&lt;/div&gt;
&lt;script&gt;
Plotly.d3.json(&#34;/plotly/Value-Units-Scatter.json&#34;, function(err, fig) {
    Plotly.plot(&#39;\/plotly\/Value-Units-Scatter.json&#39;, fig.data, fig.layout, {responsive: true});
});
&lt;/script&gt;
&lt;p&gt;This plot shows a much stronger positive correlation between units and property value. Core Campus ends up close to the top of the chart, over the top of the trend because of their luxury apartment value, and owners like Nob Hill Investments, with affordable apartments on the far south side end up on the lower end of the linear trend.&lt;/p&gt;
&lt;p&gt;Visualizing this data helps us understand how the Madison rental property value is distributed among its landlords. But Madison is a city with many (relatively) unique neighborhoods, and in order to better understand these property management company&amp;rsquo;s relationships with the community, we need to see where they own property in relation to campus, downtown and the suburbs.&lt;/p&gt;
&lt;h3 id=&#34;plotting-with-mapbox&#34;&gt;Plotting with Mapbox&lt;/h3&gt;
&lt;p&gt;You can find the most recent version of the Mapbox visualization at the following link: &lt;a href=&#34;https://madison-landlords.herokuapp.com/&#34;&gt;Madison Landlord Lookup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The goal for my final visualization was to give the user some basic statistics for Madison properties both on the individual property and property owner levels. The constantly floating tooltip in the upper left corner gives the user these stats about whichever property was the last one they hovered over.&lt;/p&gt;
&lt;p&gt;Since there are so many properties, I also found it important to let the user only focus on those that are of interest to them. Whenever you&amp;rsquo;re hovering over a property, it&amp;rsquo;s highlighted pink, as well as any other properties that are owned by the same landlord. There&amp;rsquo;s also a toggle built in that lets you click on any individual property and remove any points on the map that aren&amp;rsquo;t owned by the same landlord. This can all be reset by clicking the &amp;ldquo;reset map&amp;rdquo; button or any blank area.&lt;/p&gt;
&lt;p&gt;Although I believe this map can be informative as is, I welcome any feedback or feature improvements to either the data consolidation, cleaning or visualization processes.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
